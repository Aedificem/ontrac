function userbadges(){$(".user-badge").click(function(){var e=$(this).data("username");0===$("#"+e+"-modal").length?$.ajax({type:"GET",url:"/api/user/"+e,success:function(s){if("Not authorized."!=s){var a=(s.firstName+" "+s.lastName,["None!"]);if(s.courses.length>0){a=[];for(var t in s.courses)a.push(s.courses[t].title)}var o="",r="Not registered";s.registered&&(r=s.points+" points",o="<a class='btn btn-primary' href='/users/"+e+"'>View Full Profile</a>");var n=s.registered?"https://webeim.regis.org/photos/regis/Student/"+s.code+".jpg":s.mpicture,i=s.bio?s.bio:"Not set yet!",l=s.advisement.charAt(0),d="";switch(l){case"1":d="Frosh";break;case"2":d="Soph.";break;case"3":d="Junior";break;case"4":d="Senior"}var c=$("<div class='modal fade user-modal' id='"+e+"-modal' tabindex='-1'>        <div class='modal-dialog'>            <div class='modal-content'>                <div class='modal-header'>                    <button class='close' data-dismiss='modal' type=                    'button'><span>&times;</span></button>                    <h4 class='modal-title'>User                    Summary</h4>                </div>                <div class='modal-body'><div class='container-fluid'>    <div class='row'>        <div class='col-xs-12 col-sm-3 center-xs'>            <img class='modal-pic' title='Looking good!' src='"+n+"'>            <br><b>"+r+"</b>        </div>        <div class='col-xs-12 col-sm-9'>             <h3 class='no-margin center'><b>"+d+"</b> "+s.firstName+" "+s.lastName+" of <b>"+s.advisement+"</b></h3><br>             <div class='well well-sm'>                 <b>Bio: </b><span>"+i+"</span><br>                 <b>Classes: </b><span>"+a.join(",  ")+"</span>             </div>        </div>    </div></div>                </div>                <div class='modal-footer'>                    <button class='btn btn-default' data-dismiss='modal' type=                    'button'>Close</button>"+o+"                </div>            </div>        </div>    </div>");$("body").append(c),$("#"+e+"-modal").modal()}}}):$("#"+e+"-modal").modal()})}function teacherbadges(){$(".teacher-badge").click(function(){var e=$(this).data("username");0===$("#"+e+"-modal").length?$.ajax({type:"GET",url:"/api/teacher/"+e,success:function(s){if("Not authorized."!=s){var a=(s.firstName+" "+s.lastName,["None!"]);if(s.courses.length>0){a=[];for(var t in s.courses)a.push(s.courses[t].title)}var o=s.image,r=s.department,n=$("<div class='modal fade teacher-modal' id='"+e+"-modal' tabindex='-1'>        <div class='modal-dialog'>            <div class='modal-content'>                <div class='modal-header'>                    <button class='close' data-dismiss='modal' type=                    'button'><span>&times;</span></button>                    <h4 class='modal-title'>Teacher                    Summary</h4>                </div>                <div class='modal-body'><div class='container-fluid'>    <div class='row'>        <div class='col-xs-12 col-sm-3 center'>            <img class='modal-pic' title='Looking good!' src='"+o+"'>        </div>        <div class='col-xs-12 col-sm-9'>             <h3 class='no-margin'>"+s.firstName+" "+s.lastName+" from <b>"+r+"</b></h3><br>             <div class='well well-sm'>                 <b>Classes: </b><span>"+a.join(",  ")+"</span>             </div>        </div>    </div>    <div class='row'>       <h4>This teacher is mostly ____ by their students.</h4>    </div></div>                </div>                <div class='modal-footer'>                    <button class='btn btn-default' data-dismiss='modal' type=                    'button'>Close</button> <a class='btn btn-primary'                    href='/teachers/"+s.mID+"'>View Full Profile</a>                </div>            </div>        </div>    </div>");$("body").append(n),$("#"+e+"-modal").modal()}}}):$("#"+e+"-modal").modal()})}function effects(){function e(){var e=[];username&&$.get("/reminders/all",function(s){if(s.reminders&&0!==s.reminders.length){e=s.reminders,$("#reminder-table tr").remove();for(var a in e)$("#reminder-table").append("<tr class='reminder' data-id='"+e[a]._id+"'><td title='Added "+moment(e[a].date_added).fromNow()+"'>"+e[a].desc+"</td></tr>")}else $("#reminder-table tr").remove(),$("#reminder-table").append("<tr><td class='center'>No reminders!</td></tr>");0===e.length?$("#reminders-count").hide():($("#reminders-count").show(),$("#reminders-count").text(e.length)),$(".reminder").click(r)})}username=$("#send-message").data("username"),loggedIn=void 0!==username,$(".nav li.disabled a").click(function(){return!1}),username&&(userbadges(),teacherbadges()),$(".dial").each(function(){var e=$(this),s=Math.floor(90*Math.random()+10);e.knob({value:0,format:function(e){return e+"%"}}),$({value:0}).animate({value:s},{duration:1e3,easing:"swing",progress:function(){e.val(Math.ceil(this.value)).trigger("change")}})}),$("#chat-controls").submit(function(){return!1}),$("#chat-box.resizable").resizable({maxHeight:550,maxWidth:650,minHeight:250,minWidth:400,handles:"n"});var s=$("#chat-box.small-box"),a=$("#chat-controls.small-box"),t=$("#chat-messages.small-box"),o=function(e){1==e?(a.show(),t.show(),$(this).removeAttr("style"),s.height("300px").width("400px").css("bottom","43px")):(a.hide(),t.hide(),s.css({width:"250px",height:"40px",bottom:"0px"})),localStorage["show-chat"]=e};localStorage["show-chat"]===!1&&o(0),$("#toggle-chat").click(function(){var e=1==localStorage["show-chat"]?0:1;o(e)}),e();var r=function(){if(confirm("Remove this reminder?")){var s=$(this).data("id");$.post("/reminders/remove",{id:s},function(s){s.success===!0&&e()})}};$("#reminder-form").submit(function(){return!1}),$("#add-reminder").click(function(){$("#reminder-desc").val()&&$.post("/reminders/add",{desc:$("#reminder-desc").val()},function(s){s.success===!0&&(e(),$("#reminder-desc").val(""))})}),$("#login-form").submit(function(){var e=$("#username").val(),s=$("#password").val();return $.post("/login",{username:e,password:s},function(e){if($("#login-errors b").remove(),e.errors)for(var s in e.errors)$("#login-errors").append("<b class='text-danger'>"+e.errors[s]+"</b><br>");else window.location.href=$("#login-form").data("redirect")}),!1}),$("#feedback-form").submit(function(){return!1}),$("#send-feedback").click(function(){var e=$("#feedback-type").val(),s=$("#feedback-text").val();e&&s&&$.post("/feedback/send",{feedbackType:e,text:s},function(e){e.success===!0})})}function sockets(){function e(){d.html("");var e=[];l.forEach(function(s){"offline"!=s.status&&e.push("<span class='user-badge' data-username='"+s.username+"'>"+s.username+" ("+s.status+")</span>")}),d.html(e.join(", ")),userbadges()}function s(){var e=$("#chat-message").val();n.emit("message",{message:e,when:moment().toDate()})}function a(e){if(13==e.which){if($("#chat-message").val().trim().length<=0)return;s(),$("#chat-message").val("")}}function t(){var e=$("#chat-message").val();$("#send-message").attr("disabled",e.trim().length>0?!1:!0)}var o=new Audio("/sounds/ding.mp3"),r=location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),n=io.connect(r),i=$("#send-message").data("username"),l=[],d=$("#online-user-list");localStorage["user-status"]||(localStorage["user-status"]="online");var c=localStorage["user-status"];$("#user-status b").text(c.charAt(0).toUpperCase()+c.substring(1)),n.emit("setstatus",{status:c}),n.on("connect",function(){sessionId=n.io.engine.id}),n.on("error",function(e){}),n.on("online-list",function(s){l=s.users,$("#users-online").text(l.length+" users online"),d.length&&e()}),n.on("refresh",function(e){location.reload()}),$("#canvas").length&&(n.emit("game-get-playerlist"),n.on("game-playerlist",function(e){setPlayers(e.players)})),$("#recent-activity").length&&n.on("recent-action",function(e){}),$("#user-status li a").click(function(){var e=$(this).text().toLowerCase().trim();localStorage["user-status"]=e,n.emit("setstatus",{status:e}),$("#user-status b").text($(this).text())});var m=[];$("#chat-box").submit(function(e){return!1}),n.on("pastMessages",function(e){m=e.messages,u()});var u=function(){for(var e="<br>",s=0;s<m.length;s++){var a=m[s].user,t=m[s].message,o=moment(m[s].when),r="";a.username==i?(r+="<div class='panel panel-default message clearfix othermessage'>",r+="testuser"==a.username?"<img src='http://placehold.it/50x62'>":"<img src='https://webeim.regis.org/photos/regis/Student/"+a.code+".jpg'>",r+="<small title='"+o.format("dddd, MMMM Do YYYY, h:mm:ss a")+"'class='left padded'>"+o.fromNow()+"</small>",r+="<div class='padded clearfix'>",r+="<b><a class='undecorated' title='"+a.username+"'href='/users/"+a.username+"'>"+a.name+"</a></b><br>",r+="<span>"+t+"</span>",r+="</div>"):(r+="<div class='panel panel-default message clearfix mymessage'>",r+="testuser"==a.username?"<img src='http://placehold.it/50x62'>":"<img src='https://webeim.regis.org/photos/regis/Student/"+a.code+".jpg'>",r+="<div class='padded clearfix'>",r+="<b><a class='undecorated' title='"+a.username+"'href='/users/"+a.username+"'>"+a.name+"</a></b><br>",r+="<span>"+t+"</span>",r+="</div>",r+="<small title='"+o.format("dddd, MMMM Do YYYY, h:mm:ss a")+"'class='right padded'>"+o.fromNow()+"</small>"),r+="</div>",e+=r}$("#chat-messages").html(e),$("#chat-messages").scrollTop($("#chat-messages")[0].scrollHeight)};n.on("message",function(e){e.message&&(m.push(e),e.user.username!=i&&o.play(),u())}),$("#chat-message").on("keydown",a),$("#chat-message").on("keyup",t),$("#send-message").on("click",s)}$(function(){effects(),void 0!==$("#send-message").data("username")&&sockets()});